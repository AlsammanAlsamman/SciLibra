#:kivy 1.11.0
#:import Factory kivy.factory.Factory

############# Menu Bar ################
<MenuBar>:
    height: self.minimum_height
    orientation: 'vertical'
    size_hint: 1, None
    tree_view_drop: tree_view_drop
    actions_drop: actions_drop.__self__
    ActionBar:
        size : root.width, 40
        pos: 0, root.height - self.height
        # lime background color
        background_color: 0.678, 1, 0.184, 1
        ActionView:
            use_separator: True
            ActionPrevious:
                title: 'SciLibra'
                # color red
                background_color: 1, 0, 0, 1
                with_previous: False
                app_icon: 'icon_main.png'
            # ActionButton:
            #     text: 'help'
            #     # open small dialog with help
            #     on_release: root.show_help()
            ActionButton:
                text: 'Quit'
                on_release: app.stop()
            ActionButton:
                text: 'About'
                # create a dropdown menu
                on_press: root.show_about()
            ActionButton:
                text: 'Tree view'
                on_release: tree_view_drop.open(self)
                DropDown:
                    id: tree_view_drop
                    size_hint: None, None
            ActionButton:
                text: 'Load'
                on_release: root.show_load()
            ActionButton:
                text: 'Actions'
                on_release: actions_drop.open(self)
                DropDown:
                    id: actions_drop
                    auto_width: False
                    width: 200
                    Button:
                        text: 'Update Paths'
                        size_hint: None, None
                        height: 44
                        width: 200
                        on_release: root.updatefolderpath()
                    Button:
                        text: 'Filter Database'
                        size_hint: None, None
                        height: 44
                        width: 200
                        on_release: root.filter_database()
                    Button:
                        text: 'Save Database as BibTex'
                        size_hint: None, None
                        height: 44
                        width: 200
                        # on_release: root.save_database_as_bibtex()
                    Button:
                        # search for articles
                        text: 'Search'
                        size_hint: None, None
                        height: 44
                        width: 200
                        on_release: root.search_article()
            # empty action item to fill the space
            ActionButton:
                text: ''
                size_hint_x: 0.5
<YesNoDialog>:
    size_hint: None, None
    size: 400, 200
    title: 'Message'
    auto_dismiss: False
    BoxLayout:
        orientation: 'vertical'
        ScrollView:
            pos: 0, 0
            scroll_y: 0
            scroll_type: ['bars', 'content']
            TextInput:
                multiline: True
                text: root.message
                readonly: True
                # grey
                background_color: 0.8, 0.8, 0.8, 1
        GridLayout:
            cols: 2
            rows: 1
            size_hint_y: None
            height: 30
            Button:
                text: 'Yes'
                on_release: root.yes()
            # copy message to clipboard
            Button:
                text: 'No'
                on_release: root.no()
<SearchScreen>:
    name: 'search'
    size: 200, 200
    # labels and text boxes for article information
    GridLayout:
        cols: 1
        rows: 3
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            height: 100
            Label:
                text: 'You can split the search criteria by |||'
                size_hint_y: 10
            TextInput:
                height: 50
                size_hint_y: None
                id: search_criteria_text
                multiline: False
                text: 'Please enter search criteria'
                #clear the text box when clicked once
                on_focus: if self.focus and self.text == 'Please enter search criteria': self.text = ''
                # light grey
                background_color: 0.8, 0.8, 0.8, 1
            Button:
                text: 'Add Splitter'
                size_hint_y: 30
                on_release: search_criteria_text.text += ' ||| '
        BoxLayout:
            cols: 1
            rows: 4
            pos: 0, 0
            # start from the top
            orientation: 'vertical'
            padding: 1
            # leave the last row empty
            spacing: 0.1
            SearchCriteria:
                id: all
                criteria: 'All/NotAll'

            SearchCriteria:
                id: title
                criteria: 'title'
            SearchCriteria:
                id: authors
                criteria: 'author'
            SearchCriteria:
                id: comments
                criteria: 'comment'
            SearchCriteria:
                id: keywords
                criteria: 'keywords'
            SearchCriteria:
                id: taggroups
                criteria: 'taggroups'
            SearchCriteria:
                id: journal
                criteria: 'journal'
            SearchCriteria:
                id: year
                criteria: 'year'
            SearchCriteria:
                id: abstract
                criteria: 'abstract'
            # empty row
            BoxLayout:
                size_hint_y: None
                height: 10
        BoxLayout:
            size_hint_y: None
            height: 50
            width: 120
            # fill the space
            Button:
                # back ground image
                text: 'Search'
                #rgb(173,255,47)
                background_color: 0.678, 0.847, 0.902, 1
                on_release: root.search_article()
            Button:
                text: 'Cancel'
                #rgb(173,255,47)
                background_color: 0.678, 0.847, 0.902, 1
                on_release: root.manager.current = 'main'              


<SearchCriteria>:
    BoxLayout:
        orientation: 'vertical'
        size_hint_y: None
        height: 20
        CheckBox:
            id: criteria_checkbox
            size_hint_x: 0.1
            height: 20
            on_active: root.check_criteria(root.value)
            # if checked, add the criteria to the search list
        Label:
            text: root.criteria
            size_hint_x: 0.9


<MainScreen>:
    name: 'main'
    article_info: article_info
    menu_bar: menu_bar
    # tree_view: tree_view
    # list_tool: list_tool
    # scroll_tool: scroll_tool
    GridLayout:
        cols: 1
        rows: 2
        MenuBar:
            height: 40
            id: menu_bar
            pos: 0, root.height - self.height
        GridLayout:
            cols: 2
            rows: 1
            LibraryListView:
                id: library_view
            # Article Info
            GridLayout:
                cols: 1
                rows: 2
                RstDocument:
                    id: article_info
                    text: 'Please select an article'
                # Article Actions
                BoxLayout:
                    size_hint_y: None
                    height: 50
                    width: 120
                    Button:
                        # back ground image
                        text: 'Open'
                        #rgb(173,255,47)
                        background_color: 0.678, 0.847, 0.902, 1
                        on_release: root.parent.open_article()
                    Button:
                        text: 'Edit'
                        #rgb(173,255,47)
                        background_color: 0.678, 0.847, 0.902, 1
                        # on_release: root.edit_article()
                        on_release: root.edit_article()
                    Button:
                        text: 'Delete'
                        #rgb(173,255,47)
                        background_color: 0.678, 0.847, 0.902, 1
                        on_release: root.delete_article()
<LibraryListView>:
    list_tool: list_tool
    ScrollView:
        pos: 0, 0
        scroll_y: 1
        scroll_type: ['bars', 'content']
        canvas.before:
            Color:
                rgba: 0.6, 0.2, 0.2, 1
            Rectangle:
                pos: self.pos
                size: self.size
        do_scroll_x: False
        do_scroll_y: True
        size_hint_y: None
        # fill parent
        height: root.height
        size: root.size
        # on scroll start
        # on_scroll_start: root.on_scroll_start()
        # id: scroll_tool
        # on scroll stop
        # on_scroll_start: root.on_scroll_start()
        GridLayout:
            cols: 1
            size_hint_y: None
            height: self.minimum_height
            id: list_tool
            padding: 1
            spacing: 5
    GridLayout:
        cols: 3
        rows: 1
        width: 400
        # fill the space
        height: 50
        canvas.before:
            Color:
                rgba: 0.6, 0.2, 0.2, 1
            Rectangle:
                pos: self.pos
                size: self.size
        Button:
            text: 'Search'
            # back ground image
            background_color: 0.678, 0.847, 0.902, 1
            # on_release: root.parent.manager.main_screen.ids.menu_bar.show_search()
            size_hint_x: 0.3
        Button:
            text: 'next'
            # back ground image
            background_color: 0.678, 0.847, 0.902, 1
            on_release: root.nextPage()
            size_hint_x: 0.3
        Button:
            text: 'previous'
            # redish background
            background_color: 0.678, 0.847, 0.902, 1
            on_release: root.previousPage()
            size_hint_x: 0.3

<LibraryTooltip>:
    size_hint: None, None
    size: 400, 200
    title: 'tooltip'
    auto_dismiss: False
    BoxLayout:
        orientation: 'vertical'
        ScrollView:
            pos: 0, 0
            scroll_y: 0
            scroll_type: ['bars', 'content']
            TextInput:
                multiline: True
                text: root.tooltip_text
                # light grey
                background_color: 0.8, 0.8, 0.8, 1
                readonly: True
        GridLayout:
            cols: 2
            rows: 1
            size_hint_y: None
            height: 30
            Button:
                text: 'OK'
                on_release: root.dismiss()
            # copy message to clipboard
            Button:
                text: 'Do not show again'
                on_release: root.do_not_show_again()

<FilterDatabase>:
    size_hint: None, None
    size: 400, 200
    title: 'Filter Database'
    auto_dismiss: False
    GridLayout:
        cols: 1
        rows: 3
        # BoxLayout:
        #    # check box
        #     CheckBox:
        #         id: check_box_article_id
        #         size_hint_x: 0.1
        #         # on_active: root.show_all()
        #     Label:
        #         text: 'By Article ID'
        #         size_hint_x: 0.9 
        BoxLayout:
            # by article title
            CheckBox:
                id: check_box_article_title
                size_hint_x: 0.1
                # on_active: root.show_all()
            Label:
                text: 'By Article Title'
                size_hint_x: 0.9
        GridLayout:
            cols: 3
            rows: 1
            size_hint_y: None
            height: 30
            Button:
                text: 'Filter'
                on_release: root.filterDatabase()
                size_hint_x: 0.3
            Button:
                text: 'Cancel'
                on_release: root.dismiss()
                size_hint_x: 0.3
<LoadDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            path: "/home/samman/Documents/MobileApplications/Learn/SciLibra"
            filters: ['*.bib', '*.txt']

        GridLayout:
            cols: 2
            rows: 1
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Load"
                on_release: root.load(filechooser.path, filechooser.selection)

<EditScreen>:
    name: 'Edit'
    # labels and text boxes for article information
    article_info: article_info
    GridLayout:
        cols: 1
        rows: 2
        TextInput:
            id: article_info
            multiline: True
            text: 'Please select an article'
            # light grey
            background_color: 0.8, 0.8, 0.8, 1
        BoxLayout:
            size_hint_y: None
            height: 50
            width: 120
            # fill the space
            Button:
                # back ground image
                text: 'Update'
                #rgb(173,255,47)
                background_color: 0.678, 0.847, 0.902, 1
                on_release: root.update_article()
            Button:
                text: 'Cancel'
                #rgb(173,255,47)
                background_color: 0.678, 0.847, 0.902, 1
                on_release: root.manager.current = 'main'
<LoadProgressBar>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        ProgressBar:
            id: progress_bar
            max: 100
            value: 0
        Label:
            id: progress_label
            text: '0%'
        Button:
            text: "Cancel"
            on_release: root.cancel()
            
<PopUpMessage>:
    size_hint: None, None
    size: 400, 400
    title: 'Message'
    auto_dismiss: False
    BoxLayout:
        orientation: 'vertical'
        ScrollView:
            pos: 0, 0
            scroll_y: 0
            scroll_type: ['bars', 'content']
            TextInput:
                multiline: True
                text: root.message
                readonly: True
                # grey
                background_color: 0.8, 0.8, 0.8, 1
        GridLayout:
            cols: 2
            rows: 1
            size_hint_y: None
            height: 30
            Button:
                text: 'OK'
                on_release: root.close_popup()
            # copy message to clipboard
            Button:
                text: 'Copy'
                on_release: root.copy_message()

<UpdateFolderPath>:
    size_hint: None, None
    size: 400, 400
    title: 'Update Folder Path'
    auto_dismiss: False
    folder_paths: folder_paths
    BoxLayout:
        orientation: 'vertical'
        ScrollView:
            scroll_y: 0
            scroll_type: ['bars', 'content']
            TextInput:
                id: folder_paths
                multiline: True
                readonly: True
        GridLayout:
            cols: 3
            rows: 1
            size_hint_y: None
            height: 30
            Button:
                text: 'Add'
                on_release: root.selectfolder()
                size_hint_x: 0.3
            Button:
                text: 'Update'
                on_release: root.updatefolderpaths()
                size_hint_x: 0.3
            Button:
                text: 'Cancel'
                on_release: root.dismiss()
                size_hint_x: 0.3

<LoadFolderDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            path: root.startPath
        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()
            Button:
                text: "Load"
                on_release: root.load(filechooser.path, filechooser.selection)          
<SciLibraScreenManager>:
    MainScreen:
        id: main_screen
        name: 'main'
    EditScreen:
        id: Edit_screen
        name: 'Edit'
    SearchScreen:
        id: Search_screen
        name: 'search'